---
const consent = Astro.cookies.get('cookie_consent')?.value;
---

{!consent && (
  <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 z-[9999] p-4 md:p-6 pointer-events-none">
    <div class="pointer-events-auto max-w-4xl mx-auto bg-black/95 backdrop-blur-2xl border border-cyan-500/30 rounded-2xl p-6 shadow-2xl neon-glow animate-slide-up">
      <div class="flex flex-col md:flex-row items-center gap-4 text-white">
        <ion-icon name="cookie-outline" class="text-4xl text-cyan-400"></ion-icon>
        <div class="flex-1 text-center md:text-left">
          <h3 class="text-lg font-bold">Usamos cookies</h3>
          <p class="text-sm opacity-80 mt-1">
            Cookies esenciales para funcionamiento y analíticas anónimas. 
            <a href="/cookies-policy" class="text-cyan-400 underline hover:opacity-70">Ver política</a>.
          </p>
        </div>
        <div class="flex gap-2 flex-wrap justify-center">
          <button onclick="accept('all')" class="px-5 py-2 bg-gradient-to-r from-cyan-500 to-purple-600 rounded-lg font-medium text-sm hover:shadow-lg hover:shadow-cyan-500/50 transition-all">
            Aceptar todo
          </button>
          <button onclick="accept('essential')" class="px-5 py-2 bg-white/10 border border-white/20 rounded-lg font-medium text-sm hover:bg-white/20 transition-all">
            Solo esenciales
          </button>
          <button onclick="reject()" class="px-5 py-2 bg-red-500/20 border border-red-500/50 text-red-400 rounded-lg font-medium text-sm hover:bg-red-500/30 transition-all">
            Rechazar
          </button>
        </div>
      </div>
    </div>
  </div>
)}

<script is:inline>
  function setCookie(name, value, days = 365) {
    const d = new Date();
    d.setTime(d.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = `${name}=${value};expires=${d.toUTCString()};path=/;Secure;SameSite=Strict`;
  }

  async function logConsent(type) {
    try {
      const ip = await (await fetch('https://api.ipify.org?format=json')).json().then(r => r.ip);
      await fetch('/api/cookie-consent', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ip, type, ua: navigator.userAgent })
      });
    } catch (e) {}
  }

  window.accept = (type) => { setCookie('cookie_consent', type); logConsent(type); hide(); };
  window.reject = () => { setCookie('cookie_consent', 'rejected'); logConsent('rejected'); hide(); };
  function hide() { document.getElementById('cookie-banner')?.remove(); }
</script>

<style>
  @keyframes slide-up {
    from { transform: translateY(100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .animate-slide-up { animation: slide-up 0.6s ease-out; }
  .neon-glow { box-shadow: 0 0 30px rgba(0, 255, 255, 0.3), 0 0 60px rgba(0, 255, 255, 0.1); }
</style>